"use strict";angular.module("ntd.config",[]).value("$ntdConfig",{}),angular.module("ntd.directives",["ntd.config"]),angular.module("ntd.directives").directive("notice",["$rootScope",function(a){function b(a){var b="";("error"===a.state||"warning"===a.state)&&(b='<button class="close">x</button>');var d='<div class="flash-message '+c[a.state]+'">'+"<strong>"+a.info+"</strong>"+b+"</div>";return d}var c={info:"alert-info",error:"alert-error",success:"alert-success",warning:"alert"};return{restrict:"EAC",replace:!1,transclude:!1,link:function(c,d){a.$on("event:notification",function(a,c){d.html(b(c)),d.find("button").length?d.show().find("button").on("click",function(){d.hide()}):d.show().delay(2500).fadeOut("slow",function(){$(this).empty()})})}}}]),angular.module("ntd.directives").directive("advanceFilter",[function(){function a(a,b){$(":submit",a).clone().appendTo(f),f.addClass("skeleton"),g.hide(),a.bind("click",c),"opened"===b.advanceFilter&&$('a[data-class="J_toggleShowFilterBtn"]').trigger("click")}function b(a,b){f.toggleClass("skeleton").fadeIn(),g.animate({height:["toggle","swing"],opacity:["toggle","swing"]},200,"linear"),f.find(":submit").toggle(),$(".icon-chevron-down",b).toggleClass("icon-chevron-up")}function c(a,c){var d=a.target;($(d).attr("data-class")||$(d).parent().attr("data-class"))===e&&b(c)}var d,e,f,g,h='<div class="advance-search-filter"><div ng-transclude></div><div class="more"><a data-class="J_toggleShowFilterBtn"><i class="icon-chevron-down"></i></a></div></div>';return{restrict:"A",template:h,transclude:!0,link:function(b,c,h){d=$(c).find("fieldset"),e="J_toggleShowFilterBtn",f=d.eq(0),g=d.not(d.eq(0)),a(c,h)}}}]),angular.module("ntd.directives").directive("confirmButton",["$document","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f,g,h,i,j,k,l;return f=Math.floor(1e10*Math.random()),e.buttonId=f,h=e.message||"",k=e.yes||"确定",i=e.no||"取消",j=e.title||"确认删除?",l=e.position||"top",g='<div id="button-'+f+'">'+'<span class="confirmbutton-msg">'+h+"</span>"+'<button type="button" class="confirmbutton-yes btn btn-primary">'+k+"</button>\n"+'<button type="button" class="confirmbutton-no btn">'+i+"</button>"+"</div>",d.popover({content:g,html:!0,placement:l,trigger:"manual",title:j}),d.bind("click",function(g){var h,i;h=!0,g.stopPropagation(),$('[id^="button-"]').closest(".popover").hide(),d.popover("show"),i=$("#button-"+f),i.closest(".popover").click(function(a){h&&a.stopPropagation()}),i.find(".confirmbutton-yes").click(function(){h=!1;var a=b(e.confirmButton);a(c)}),i.find(".confirmbutton-no").click(function(){h=!1,a.off("click.confirmbutton."+f),d.popover("hide")}),a.on("click.confirmbutton."+f,":not(.popover, .popover *)",function(){a.off("click.confirmbutton."+f),d.popover("hide")})})}}}]),angular.module("ntd.directives").directive("datePicker",["$timeout","$ntdConfig",function(a,b){var c=/(iP(a|o)d|iPhone)/g.test(navigator.userAgent),d=function(a){return a=a||"en",{"/":"[\\/]","-":"[-]",".":"[.]"," ":"[\\s]",dd:"(?:(?:[0-2]?[0-9]{1})|(?:[3][01]{1}))",d:"(?:(?:[0-2]?[0-9]{1})|(?:[3][01]{1}))",mm:"(?:[0]?[1-9]|[1][012])",m:"(?:[0]?[1-9]|[1][012])",DD:"(?:"+$.fn.datepicker.dates[a].days.join("|")+")",D:"(?:"+$.fn.datepicker.dates[a].daysShort.join("|")+")",MM:"(?:"+$.fn.datepicker.dates[a].months.join("|")+")",M:"(?:"+$.fn.datepicker.dates[a].monthsShort.join("|")+")",yyyy:"(?:(?:[1]{1}[0-9]{1}[0-9]{1}[0-9]{1})|(?:[2]{1}[0-9]{3}))(?![[0-9]])",yy:"(?:(?:[0-9]{1}[0-9]{1}))(?![[0-9]])"}},e=function(a,b){var c,e=a,f=d(b);return c=0,angular.forEach(f,function(a,b){e=e.split(b).join("${"+c+"}"),c++}),c=0,angular.forEach(f,function(a){e=e.split("${"+c+"}").join(a),c++}),new RegExp("^"+e+"$",["i"])};return{restrict:"A",require:"?ngModel",link:function(a,d,f,g){var h=angular.extend({autoclose:!0},b.datepicker||{}),i=f.dateType||h.type||"date";angular.forEach(["format","weekStart","calendarWeeks","startDate","endDate","daysOfWeekDisabled","autoclose","startView","minViewMode","todayBtn","todayHighlight","keyboardNavigation","language","forceParse"],function(a){angular.isDefined(f[a])&&(h[a]=f[a])});var j=h.language||"en",k=f.dateFormat||h.format||$.fn.datepicker.dates[j]&&$.fn.datepicker.dates[j].format||"mm/dd/yyyy",l=c?"yyyy-mm-dd":k,m=e(l,j);g&&(g.$formatters.unshift(function(a){return"date"===i&&angular.isString(a)&&a?$.fn.datepicker.DPGlobal.parseDate(a,$.fn.datepicker.DPGlobal.parseFormat(k),j):a}),g.$parsers.unshift(function(a){return a?"date"===i&&angular.isDate(a)?(g.$setValidity("date",!0),a):angular.isString(a)&&m.test(a)?(g.$setValidity("date",!0),c?new Date(a):"string"===i?a:$.fn.datepicker.DPGlobal.parseDate(a,$.fn.datepicker.DPGlobal.parseFormat(l),j)):(g.$setValidity("date",!1),void 0):(g.$setValidity("date",!0),null)}),g.$render=function(){if(c){var a=g.$viewValue?$.fn.datepicker.DPGlobal.formatDate(g.$viewValue,$.fn.datepicker.DPGlobal.parseFormat(l),j):"";return d.val(a),a}return g.$viewValue||d.val(""),d.datepicker("update",g.$viewValue)}),c?d.prop("type","date").css("-webkit-appearance","textfield"):(g&&d.on("changeDate",function(b){a.$apply(function(){g.$setViewValue("string"===i?d.val():b.date)})}),d.datepicker(angular.extend(h,{format:l,language:j})),a.$on("$destroy",function(){var a=d.data("datepicker");a&&(a.picker.remove(),d.data("datepicker",null))}));var n=d.siblings('[data-toggle="datepicker"]');n.length&&n.on("click",function(){d.trigger("focus")})}}}]),angular.module("ntd.directives").directive("timePicker",["$timeout",function(a){var b="((?:(?:[0-1][0-9])|(?:[2][0-3])|(?:[0-9])):(?:[0-5][0-9])(?::[0-5][0-9])?(?:\\s?(?:am|AM|pm|PM))?)";return{restrict:"A",require:"?ngModel",link:function(c,d,e,f){if(f){d.on("changeTime.timepicker",function(){a(function(){f.$setViewValue(d.val())})});var g=new RegExp("^"+b+"$",["i"]);f.$parsers.unshift(function(a){return!a||g.test(a)?(f.$setValidity("time",!0),a):(f.$setValidity("time",!1),void 0)})}d.attr("data-toggle","timepicker"),d.parent().addClass("bootstrap-timepicker"),d.timepicker();var h=d.data("timepicker"),i=d.siblings('[data-toggle="timepicker"]');i.length&&i.on("click",$.proxy(h.showWidget,h))}}}]),angular.module("ntd.directives").directive("easyPieChart",["$compile","$timeout",function(){return{restrict:"A",scope:{item:"=easyPieChart"},replace:!0,template:'<div class="easy-pie-chart"><div data-percent="{{item.percent}}">{{item.usage}}</div><div class="caption">{{item.caption}}</div></div>',link:function(a,b,c){var d=["#08c","#e7912a","#bacf0b","#4ec9ce","#ec7337","#f377ab"],e=c.easyPieChartLineWidth||12,f=c.easyPieChartSize||100,g=d[a.$parent.$index%6]||"#08c",h={animate:2e3,scaleColor:!1,lineWidth:e,lineCap:"square",size:f,barColor:g,trackColor:"#e5e5e5"},i=function(){$(angular.element(b.children()[0])).easyPieChart(h)};$(b).parent().addClass("easy-pie-chart-widget"),c.$observe("easyPieChart",i)}}}]),angular.module("ntd.directives").directive("fooTable",[function(){return{restrict:"A",link:function(a,b){$(b).addClass("footable").footable()}}}]),angular.module("ntd.directives").directive("nanoScrollbar",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){function e(){var a={height:function(){return $(window).width()<767?200:$(window).height()-80},showScrollBar:function(){return $(window).width()<767?!0:!1}};$(".nano",c).css({height:a.height()}).nanoScroller({preventPageScrolling:!0,iOSNativeScrolling:!0,alwaysVisible:a.showScrollBar()})}var f='<div class="span2 affix"><div class="nano"><div class="content"></div></div></div>';$(c).children().wrap(f),d.$observe("nanoScrollbar",e),$(c).on("click",function(){a(e,200)}),$(window).bind("load resize",e)}}}]),angular.module("ntd.directives").directive("labelState",[function(){return{restrict:"A",transclude:!0,scope:{tips:"@labelState"},template:'<span ng-transclude></span><i tooltip-popup-delay="300" tooltip="{{tips}}" class="icon-question-sign"></i>'}}]),angular.module("ntd.directives").directive("navBar",["$location",function(a){return{restrict:"A",link:function(b,c){b.$watch(function(){return a.path()},function(a){$("li[data-match-route]",c).each(function(b,c){var d=angular.element(c),e=d.attr("data-match-route"),f=new RegExp("^"+e+"$",["i"]);f.test(a)?(d.addClass("active"),d.find("ul").length&&d.addClass("opened").find("ul").show()):d.removeClass("active")})})}}}]),angular.module("ntd.directives").directive("toggleSubmenu",[function(){return{restrict:"A",link:function(a,b){function c(){$("#J_subMenu").parent().toggle(),$("#J_mainContent").toggleClass("span10")}b.bind("click",function(){$(this).bind("selectstart",function(){return!1}),$(this).parent().toggleClass("active"),c()})}}}]),angular.module("ntd.directives").directive("subTreemenu",[function(){return{restrict:"A",link:function(a,b){b.on("click",function(a){var b=a.target;"a"===b.nodeName.toLowerCase()&&$(b).next("ul").length&&($(b).next("ul").slideToggle("fast"),$(b).parent().toggleClass("opened"),$(b).bind("selectstart",function(){return!1}))})}}}]),angular.module("ntd.directives").directive("ntdPie",[function(){return{restrict:"A",link:function(a,b,c){var d="#"+c.id,e=a[c.data].analysis,f=c.pieWidth||800,g=c.pieHeight||300,h=Math.min(f,g)/2,i=d3.scale.ordinal().range(["#fdc79b","#ee6962","#5d96b1","#b8d97e","#24CBE5","#64E572","#FF9655","#FFF263"]),j=d3.svg.arc().outerRadius(h-10).innerRadius(0),k=d3.layout.pie().sort(null).value(function(a){return a.value}),l=d3.select(d).append("svg").attr("width",f).attr("height",g).append("g").attr("transform","translate("+f/2+","+g/2+")"),m=l.selectAll(".arc").data(k(e)).enter().append("g").attr("class","arc");m.append("path").attr("d",j).style("fill",function(a){return i(a.data.name)}),m.append("text").attr("transform",function(a){return"translate("+j.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.name});var n=l.selectAll(".legend").data(i.domain().slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+20*b+")"});n.append("rect").attr("x",f-430).attr("width",18).attr("height",18).style("fill",i),n.append("text").attr("x",f-440).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a})}}}]),angular.module("ntd.directives").directive("loadingButton",[function(){return{restrict:"A",link:function(a,b,c){a.$watch(function(){return a.$eval(c.loadingButton)},function(a){a?(c.hasOwnProperty("ngDisabled")||b.addClass("disabled").attr("disabled","disabled"),b.data("resetText",b.html()),b.html(b.data("loading-text"))):(c.hasOwnProperty("ngDisabled")||b.removeClass("disabled").removeAttr("disabled"),b.html(b.data("resetText")))})}}}]),angular.module("ntd.directives").directive("slimScroll",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){function e(){return $(window).width()<767?200:$(window).height()-80}function f(){$(".slimScroll",c).parent(".slimScrollDiv").css({height:e()+"px"}),$(".slimScroll",c).css({height:e()+"px"}).slimscroll({distance:"2px"})}if("yes"==d.slimScrollMenu){var g='<div class="span2 affix"><div class="slimScroll"></div></div>';$(c).children().wrap(g),d.$observe("slimScroll",f),$(c).on("click",function(){a(f,200)}),$(window).bind("load resize",f)}else $(c).slimscroll({width:d.slimScrollWidth||"auto",height:d.slimScrollHeight||"250px",size:d.slimScrollSize||"7px",color:d.slimScrollColor||"#000",position:d.slimScrollPosition||"right",distance:d.slimScrollDistance||"1px",start:"top",opacity:.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:d.slimScrollRailColor||"#333",railOpacity:.2,railDraggable:!0,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,wheelStep:20,touchScrollStep:200})}}}]),angular.module("ntd.directives").directive("cascadeList",["$parse",function(){function a(a){var d=c(a),e=c(h.ngModel),f=d?d.level+1:0,i=$("<ul></ul>").css("margin-left",33*f+"%").attr("cl-id",a);for(var j in g){var k=g[j];if(k.parent==a){var l=$('<li cl-value="'+k.value+'">'+k.text+"</li>").click(b);k.children().length>0&&l.addClass("has-child"),k.value==h.ngModel&&i.addClass("selective"),e&&e.path.indexOf(""+k.value)>-1&&l.addClass("selective"),i.append(l)}}return i}function b(b){var c=$(b.target).addClass("selective"),e=c.parent().addClass("selective"),g=c.attr("cl-value");if(e.nextAll("ul").remove(),c.prevAll(".selective").removeClass("selective"),c.nextAll(".selective").removeClass("selective"),e.prevAll(".selective").removeClass("selective"),c.hasClass("has-child")){var h=a(g);f.append(h);var i=f.offset().left+2*f.width()/3;b.clientX>i&&f.scrollLeft(e.prev().offset().left)}d(g)}function c(a){var b=g.filter(function(b){return b.value==a});return b[0]}function d(a){h.ngModel=a,h.$apply()}function e(){if(f.html(""),void 0!=g&&0!=g.length){var b=h.ngModel,d=c(b);b=d?d.children().length>0?d.value:d.parent:0;do{f.prepend(a(b));var d=c(b);b=d?d.parent:0}while(d);var e=f.find("ul.selective");if(e.length>0){var i=f.parent().offset().left+2*f.parent().width()/3;e.offset().left>i&&f.scrollLeft(e.prev().offset().left)}}}var f,g,h,i=function(a,b){var c=[];for(var d in a){var e=a[d],f=e[b.path].split("/").slice(1,-1);c.push({value:e[b.value],text:e[b.text],parent:e[b.parent],path:f,level:f.length-1,children:function(){var c=this.value,d=a.filter(function(a){return a[b.parent]==c});return d}})}return c};return{restrict:"ACE",replace:!1,scope:{ngModel:"=",data:"="},link:function(a,b,c){h=a,f=$('<div class="cascade-list-inner"></div>').css("width",c.width||"400px").css("height",c.height||"120px"),b.append(f).addClass("cascade-list");var d={name:c.name,parent:c.parent||"parent",value:c.value||"id",text:c.text||"name",path:c.path||"path"};a.$watch("data",function(a){g=new i(a,d),e(g)}),a.$watch("ngModel",function(a,b){a!=b&&e()})}}}]);